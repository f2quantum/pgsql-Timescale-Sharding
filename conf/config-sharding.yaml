#Sharding-Proxy支持多逻辑数据源，每个以config-前缀命名的yaml配置文件，即为一个逻辑数据源。以下是config-xxx.yaml的配置配置示例。
# refer: 
#逻辑数据源名称
schemaName: gisdb

#省略数据源配置，与数据分片一致
# refer: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/
dataSources:
  ds_0: 
    url: jdbc:postgresql://timescaledb01:5432/gisdb_0
    username: timescaledb
    password: password
    connectionTimeoutMilliseconds: 30000
    idleTimeoutMilliseconds: 60000
    maxLifetimeMilliseconds: 1800000
    maxPoolSize: 65
  ds_1:
    url: jdbc:postgresql://timescaledb01:5432/gisdb_1
    username: timescaledb
    password: password
    connectionTimeoutMilliseconds: 30000
    idleTimeoutMilliseconds: 60000
    maxLifetimeMilliseconds: 1800000
    maxPoolSize: 65

  ds_2: 
    url: jdbc:postgresql://timescaledb02:5432/gisdb_0
    username: timescaledb
    password: password
    connectionTimeoutMilliseconds: 30000
    idleTimeoutMilliseconds: 60000
    maxLifetimeMilliseconds: 1800000
    maxPoolSize: 65

  ds_3: 
    url: jdbc:postgresql://timescaledb02:5432/gisdb_1
    username: timescaledb
    password: password
    connectionTimeoutMilliseconds: 30000
    idleTimeoutMilliseconds: 60000
    maxLifetimeMilliseconds: 1800000
    maxPoolSize: 65


rules:
- !SHARDING
  tables:
    time_series: 
      actualDataNodes: ds_${0..3}.time_series_${0..1}
      tableStrategy: 
        standard:
          shardingColumn: id
          shardingAlgorithmName: time_series_inline
      keyGenerateStrategy:
        column: id
        keyGeneratorName: snowflake
      auditStrategy:
        auditorNames:
          - sharding_key_required_auditor
        allowHintDisable: true
  defaultShardingColumn: id
  bindingTables:
    - time_series
  defaultDatabaseStrategy:
    standard:
      shardingColumn: id
      shardingAlgorithmName: database_inline
  defaultTableStrategy:
    none:
  shardingAlgorithms:
    database_inline:
      type: INLINE
      props:
        algorithm-expression: ds_${id % 2}
    time_series_inline:
      type: INLINE
      props:
        algorithm-expression: time_series_${id % 2}

  keyGenerators:
    snowflake:
      type: SNOWFLAKE
  auditors:
    sharding_key_required_auditor:
      type: DML_SHARDING_CONDITIONS

